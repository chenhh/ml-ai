# 相空間重構

## 相空間重構簡介\(phase space reconstruction\)

一般的時間序列主要是在時間域中進行模型的研究，而對於**混沌時間序列**，無論是混沌不變量的計算，混沌模型的建立和預測都是在所謂的相空間中進行，因此相空間重構就是混沌時間序列處理中非常重要的一個步驟。

所謂混沌序列，可以看作是考察混沌系統所得到的一組隨著時間而變化的觀察值。假設時間序列是 $$\{ x(i), ~i=1,2,\ldots, n\}$$。

那麼**吸引子（attactor）**的結構特性就包含在這個時間序列之中。為了從時間序列中提取出更多有用的資訊，1980 年 Packard 等人提出了時間序列重構相空間的兩種方法：**導數重構法和坐標延遲重構法**。而後者的本質則是通過一維的時間序列 $$\{x(i)\}$$ 的不同延遲時間 $$\tau$$來構建 $$d$$維的相空間向量：$$y(i) = [x(i), \ldots, x(i+(d-1)\tau)] \in \mathbb{R}^d, ~ 1 \leq i \leq n-(d-1)\tau$$

1981年 Takens 提出**嵌入定理（delay embedding theorem,** [**wikipedia**](https://en.wikipedia.org/wiki/Takens%27s_theorem)**）**：對於無限長，無噪聲的$$d^{'}$$維混沌吸引子的一維標量時間序列$$\{x(i), i=1,2,\ldots, n\}$$都可以在拓撲不變的意義下找到一個 $$d$$ 維的嵌入相空間，只要維數$$d \leq 2d^{'}+1$$。 **根據 Takens 嵌入定理，我們可以從一維混沌時間序列中重構一個與原動力系統在拓撲意義下一樣的相空間**，混沌時間序列的判定，分析和預測都是在這個重構的相空間中進行的，因此相空間的重構就是混沌時間序列研究的關鍵。

## 相空間重構

**相空間重構技術有兩個關鍵的參數：嵌入的維數** $$d$$ **和延遲時間**$$\tau$$。 在 Takens 嵌入定理中，嵌入維數和延遲時間都只是理論上證明了其**存在性**，並沒有給出具體的表達式，而且實際應用中時間序列都是有噪聲的有限序列，嵌入維數和時間延遲必須要根據實際的情況來選取合適的值。

關於嵌入維數 $$d$$和延遲時間 $$\tau$$的取值，通常有兩種觀點：

* 第一種觀點認為$$d$$ 和$$\tau$$是互不相關的，先求出延遲時間之後再根據它求出合適的嵌入維數。求出延遲時間$$\tau$$比較常用的方法主要有**自相關法，平均位移法，復自相關法和互資訊法**等，關鍵的地方就是使得原時間序列經過時間延遲之後可以作為獨立的坐標來使用。同時尋找嵌入維數的方法主要是**幾何不變量方法，虛假最臨近法\(False Nearest Neighbors\)和它改進之後的 Cao 方法**等。
* 第二種觀點則是認為延遲時間和嵌入維數是相關的。1996 年 Kugiumtzis 提出的時間窗長度則是綜合考慮兩者的重要參數。1999年，Kim 等人提出了 C-C 方法，該方法使用關聯積分同時估計出延遲時間和時間窗。

## 延遲時間的確定

如果延遲時間 $$\tau$$太小，則相空間向量：$$y(i)=[x(i), \ldots, x(i+(d-1)\tau)] \in \mathbb{R}^d$$中的兩個座標分量$$x(i+j\tau)$$與$$x(i+(j-1)\tau)$$在數值上非常接近，以至於無法相互區分，從而無法提供兩個獨立的坐標份量；但是如果延遲時間$$\tau$$太大的話，則兩個座標分量又會出現一種完全獨立的情況，混沌吸引子的軌跡在兩個方向上的投影就毫無相關性可言。因此需要合適的方法來確定一個合適的延遲時間$$\tau$$，以在在獨立和相關兩者之間達到一種平衡。

### 自相關系數法（autocorrelation）

自相關函數是求延遲時間$$\tau$$比較簡單的一種方法，它的主要理念就是提取序列之間的線性相關性。對於混沌序列$$x(1), x(2),\ldots, x(n)$$可以寫出其自相關函數如下：

$$
R(\tau)=\frac{1}{n}\sum_{i=1}^{n-\tau}x(i)\cdot x(i+\tau)
$$

此時就可以使用已知的資料$$x(1), x(2),\ldots, x(n)$$來做出自相關函數$$R(\tau)$$隨著延遲時間 $$\tau$$變化的圖像，當自相關函數下降到初始值$$R(0)$$的 $$1-\frac{1}{e}$$時，即$$R(\tau)=(1-\frac{1}{e})R(0)$$所得到的時間$$\tau$$也就是重構相空間的延遲時間。

雖然自相關函數法是一種簡便有效的計算延遲時間的方法，但是它僅僅能夠提取時間序列的**線性相關性**。根據自相關函數法可以讓$$x(i), x(i+\tau)$$以及$$x(i+\tau), x(i+2\tau)$$之間不相關，但是 $$x(i), x(i+2\tau)$$之間的相關性可能會很強。這一點意味著這種方法並不能夠有效的推廣到高維的研究。而且選擇下降係數 $$1-\frac{1}{e}$$時，這一點可能有點主觀性，需要根據具體的情況做適當的調整。因此再總結了自相關法的不足之後，下面介紹一種判斷系統非線性關系性的一種方法：互動資訊法。

###  互資訊法（mutual information）

在考慮了以上方法的侷限性之後，Fraser 和 Swinney 提出了互動資訊法（Mutual Information Method）。假設兩個離散資訊系統$$\{s_1,s_2,\ldots, s_m\}, \{q_1, q_2, \ldots, q_n\}$$所構成的系統$$S$$和$$Q$$。

由資訊論和遍歷論的知識，從兩個系統中獲得的資訊熵分別是：

* $$\displaystyle \mathrm{H}(S)=- \sum_{i=1}^m \mathrm{P_S}(s_i)\log_2(s_i)$$
* $$\displaystyle \mathrm{H}(Q)=- \sum_{j=1}^n \mathrm{P_Q}(q_j)\log_2(q_j)$$
* 其中$$\mathrm{P_S}(s_i), \mathrm{P_Q}(q_j$$分別是$$S$$和$$Q$$中事件$$s_i$$和$$q_j$$的機率。

可得互資訊$$\mathrm{I}(S,Q)$$（兩個系統共有的資料量）為：

* $$\mathrm{I}(S,Q)=\mathrm{H}(S)+\mathrm{H}(Q)-\mathrm{H}(S,Q)$$
* $$\displaystyle \mathrm{H}(S,Q)=- \sum_{i=1}^m \sum_{j=1}^n \mathrm{P_{S,Q}}(s_i, q_j)\log_2 \mathrm{P_{S,Q}}(s_i, q_j)$$為聯合熵。

現在可以通過資訊論的方法來計算延遲時間$$\tau$$。

定義$$(S,Q)=(x(i), x(i+\tau), ~ 1 \leq i \leq n-r$$，也就是系統$$S$$代表時間$$x(i)$$，系統$$Q$$代表時間$$x(i+\tau)$$，則$$\mathrm{I}(S,Q)$$則是關於延遲時間$$\tau$$的函數，可寫成$$\mathrm{I}(\tau)$$，其值表示在已知系統$$S$$（即$$x(i)$$）的情況下，系統$$Q$$（即$$x(i+\tau)$$）的確定性大小。$$\mathrm{I}(\tau)=0$$表示$$x(i)$$與$$x(i+\tau)$$完全不相關，因此完全無法預測。而$$\mathrm{I}(\tau)$$的第一個極小值，則表示了$$x(i)$$與$$x(i+\tau)$$是最大可能的不相關，重構時使用$$I(\tau)$$的第一個極小值為最優的延遲時間$$\tau$$。

互動資訊法的關鍵在於怎麼計算聯合機率分佈$$\mathrm{P}_{S,Q}(s_i, q_j)$$以及$$S$$ 和$$Q$$系統的機率分佈$$\mathrm{P}_S(s_i)$$和 $$\mathrm{P}_Q(q_j)$$這裡採取的方法是**等間距格子法**，其方法簡要概述如下。

令$$(S,Q)=(x(i), x(i+\tau)，~ 1 \leq i \leq n-r$$在$$(S,Q)$$平面用一個矩形包含上面所有的點。將矩形 $$S$$方向上等分成$$M_1$$份， $$Q$$方向等分成$$M_2$$份（註： $$M_1, M_2$$取值100~200之間即可）。那麼在$$S$$方向上格子的長度就是$$\epsilon_1$$， $$Q$$方向上格子的長度就是$$\epsilon_2$$，假設$$(a,b)$$是$$(S,Q)$$ 平面矩形左下角的頂點坐標。

* 如果$$(i-1)\epsilon_1 \leq s-a < i \epsilon_1$$，則$$s$$在第$$i$$個格子中，對$$Row[i]$$做一次紀錄；
* 如果$$(j-1)\epsilon_2 \leq q-b < j \epsilon_2$$，則$$q$$在第$$j$$個格子中，對$$Col[j]$$做一次紀錄。

$$x(i)$$與$$x(i+\tau)$$序列的總數都是$$n-\tau$$，因此機率：

* $$\mathrm{P}_S(i) = \frac{Row[i]}{n-\tau}, ~ 1 \leq i \leq M_1$$
* $$P_Q(j) = \frac{Col[j]}{n-\tau}, ~ 1 \leq j\leq M_2$$

如果$$(i-1)\epsilon_1 \leq s-a < i \epsilon_1$$且$$(j-1)\epsilon_2 \leq q-b \leq j \epsilon_2$$，則$$(s,q)$$落在標號為$$(i,j)$$的格子中，對$$Together[i,j]$$做一次紀錄，可得：

* $$\mathrm{P}_{S,Q}(i,j) = \frac{Together[i,j]}{(n-\tau)^2}, ~ 1 \leq i \leq M_1, ~ 1 \leq j \leq M_2$$

計算出機率後，可以算出資訊熵$$\mathrm{H}(S), \mathrm{H}(Q), \mathrm{H}(S,Q),$$與互資訊$$\mathrm{I}(S,Q)$$以及經標準化的互資訊$$\hat{\mathrm{I}}(S,Q) = \mathrm{I}(S,Q)/ \sqrt{\mathrm{H}(S) \mathrm{H}(Q)}$$。

互資訊區線$$\mathrm{I}(\tau) = \hat{\mathrm{I}}(S,Q)$$第一次下降到（局部）極小值所對應的延遲時間$$\tau$$即為最佳延時時間。

## 嵌入維數的確定

### 幾何不變量法

為了確定嵌入維數$$d$$，實際應用中通常的方法是**計算吸引子的某些幾何不變量**（如關聯維數，Lyapunov 指數等）。選擇好延遲時間 $$\tau$$之後，逐漸增加維數$$d$$直到他們（幾何不變量）停止變化為止。

從Takens 嵌入定理分析可知，**這些幾何不變量具有吸引子的幾何性質，當維數**$$d$$**大於最小嵌入維數的時候，幾何結構已經被完全打開，此時這些幾何不變量與嵌入的維數無關**。基於此理論，可以選擇吸引子的幾何不變量停止變化時的嵌入維數$$d$$作為重構的相空間維數。

### 虛假最臨近點法

從幾何的觀點來看，混沌時間序列是高維相空間混沌運動的軌跡在一維空間的投影，在這個投影的過程中，混沌運動的軌跡就會被扭曲。**高維相空間並不相鄰的兩個點投影到一維空間上有的時候就會成為相鄰的兩點，也就是虛假鄰點**。

重構相空間，實際上就是從混沌時間序列中恢復混沌運動的軌跡，隨著嵌入維數的增大，混沌運動的軌道就會被打開，虛假鄰點就會被逐漸剔除，從而整個混沌運動的軌跡得到恢復，這個思想就是虛假最臨近點法的關鍵。

在$$d$$維相空間中，每一個向量點： $$y_i(d)=[x(i), \ldots, x(i+(d-1)\tau)], ~ 1 \leq i \leq n-(d-1)\tau$$，都是有一個歐式距離的最鄰近點 $$y_{n(i,d)}(d)$$，其中$$n(i,d)\neq i, ~ 1\leq n(i,d) \leq n-(d-1)\tau$$，其距離是$$R_i(d) =\| y_i(d)- y_{n(i,d)}(d)\|_2$$

當相空間的維數從$$d$$變成$$d+1$$時，這兩個點的距離就會發生變化，新的距離是$$R_i(d+1)$$且有以下的關係：$$[R_i(d+1)]^2 = [R_i(d)]^2+\| x(i+d\tau) -x(n(i,d)+d\tau)\|_2^2$$。

**如果**$$R_i(d+1)$$**比**$$R_i(d)$$**大很多，則可以認為這是由於高維混沌吸引子中兩個不相鄰得點投影到低維坐標上變成相鄰的兩點造成的，這樣的臨近點是虛假的**。

令$$a_1(i,d) =\| x(i+d\tau) - x(n(i,d)+d\tau) \|_2 /R_d(i)$$，如果$$a_1(i,d) > R_\tau \in [10, 50]$$，則$$y_{n(i,d)}(d)$$就是$$y_i(d)$$的虛假最臨近點，此處$$R\tau$$為閥值。

## 參考資料

* Floris Takens, "Detecting strange attractors in turbulence." Dynamical systems and turbulence, pp 366-381, 1981.
* Lyle Noakes, "The Takens embedding theorem." International Journal of Bifurcation and Chaos, Vol. 01, No. 04, pp. 867-872, 1991.

