# 外部、內部、交換遺憾

## 遺憾的關係

外部遺憾 ⊆ 內部遺憾 ⊆ 交換遺憾

* **Swap regret = 最強**（允許隨時根據狀況調整）
  * $$\displaystyle\displaystyle \text{swap regret} = \sum_{t=1}^T l_t(a_t) - \min_{\phi} \sum_{t=1}^T l_t(\phi(a_t))$$
* **Internal regret = 次強**（允許在某些情境換選擇）
  * $$\displaystyle \text{internal regret}^{i \rightarrow j} = \sum_{t=1}^T \mathbf{I}(a_t=i)l_t(a_t) - \sum_{t=1}^T \mathbf{I}(a_t=i)l_t(j)$$
* **External regret = 最弱**（只能跟固定策略比較）
  * $$\displaystyle \text{external regret} = \sum_{t=1}^T l_t(a_t) - \min_{a^{*}} \sum_{t=1}^T l_t(a^{*})$$

內部遺憾可以看作是 "動作對" 外部遺憾的總和。 你可以把內部遺憾分解成許多個外部遺憾的總和。 對於每個動作對 (i, j)，內部遺憾可以看作是針對「是否將動作 i 替換成動作 j」這個子問題的外部遺憾。

交換遺憾進一步泛化了內部遺憾。 內部遺憾只考慮將一個動作替換成另一個動作，而交換遺憾則允許更複雜的策略調整，例如根據時間、過去的動作等來進行調整。

一般來說，「交換遺憾」已經被認為是最強大、最廣泛，且最能體現策略優劣的遺憾概念。 它涵蓋了策略調整的各種可能性，並且是許多無遺憾演算法 (No-Regret Algorithm) 的核心目標。

| 遺憾類型            | 比較對象             | 影響                  | 應用                 |
| --------------- | ---------------- | ------------------- | ------------------ |
| External Regret | 與最佳固定策略比較        | 決策是否接近「事後看來最好」的固定策略 | 適用於需要與單一最佳策略比較的場景  |
| Internal Regret | 與自己內部的選擇變化比較     | 是否後悔在某些狀況下沒有改變選擇    | 適用於需要考慮策略之間切換的場景   |
| Swap Regret     | 允許根據情境換選擇的最佳策略比較 | 是否能學習到動態調整的最佳策略     | 適用於需要考慮所有可能策略替換的場景 |

## 外部遺憾(external regret)

在整個決策過程中，如果我們 始終選擇一個固定的最佳動作 (從事後諸葛的角度來看)，會比我們實際採取的策略 多獲得 多少回報。

<mark style="color:red;">直觀理解: 外部遺憾就像是在反思：「如果我當時就堅持選擇某一個動作，而不是像現在這樣變來變去，是不是會更好？」它衡量的是與「最佳固定策略」之間的差距</mark>。

範例：假設你每天都需要決定早上喝咖啡、茶還是果汁。經過一年 (365天) 後，你想評估你的飲料策略。

* 你計算出如果每天都喝咖啡，一年的總體滿足感是 X。&#x20;
* 你計算出如果每天都喝茶，一年的總體滿足感是 Y。&#x20;
* 你計算出如果每天都喝果汁，一年的總體滿足感是 Z。&#x20;
* 你再計算出你實際每天選擇不同飲料的總體滿足感是 W。&#x20;
* 外部遺憾就是比較 W 與 X, Y, Z 中最大值之間的差距。例如，如果 X 最大，則外部遺憾就與 X - W 有關。

## 內部遺憾 (Internal Regret)

定義: 內部遺憾衡量的是，在整個決策過程中，如果我們 在過去某些時間點，將原本選擇的某個動作$$i$$，替換成另一個動作$$j$$，會比我們實際採取的策略多獲得多少回報。

<mark style="color:red;">直觀理解: 內部遺憾更精細，它不只是比較與固定策略的差距，而是反思：「在過去我選擇了動作 i 的時候，如果我改為選擇 j，是不是會更好？」它衡量的是策略內部調整的潛在收益</mark>。

內部遺憾關注的是 **動作對(action pair)**。 對於每個動作對$$(i, j)$$，我們考慮所有我們在過去選擇了動作$$i$$ 的輪次。在這些輪次中，如果我們 **改為選擇動作**$$j$$，並保持其他輪次的動作不變，然後比較這樣修改後的策略的累計回報，與我們實際策略的累計回報之間的差距。

**例子 (延續飲料例子):**

假設你想評估「咖啡 vs. 茶」的內部遺憾。

* 你找出過去一年中，你所有選擇喝咖啡的日子。
* 在這些日子裡，假設你都改為喝茶，並重新計算一年的總體滿足感，設為 W'。
* 內部遺憾 (咖啡 -> 茶) 就與 W' - W 有關。

你會對所有可能的動作對 (例如，咖啡->茶, 咖啡->果汁, 茶->咖啡, 茶->果汁, 果汁->咖啡, 果汁->茶) 都計算內部遺憾。

## 交換遺憾 (Swap Regret)

定義: 交換遺憾是最廣泛且最強的遺憾概念。它衡量的是，在整個決策過程中，如果我們 使用任何可能的 "交換函數" (Swap Function) 來系統性地改變我們的動作選擇，會比我們實際採取的策略多獲得多少回報。

更具體地說:

一個交換函數$$f$$ 指定了在每個輪次$$t$$，如果你本來要選擇動作$$i$$，你會改為選擇動作 $$f(i)$$。 這個交換函數可以任意複雜，它甚至可以依賴於過去的動作和觀察 (儘管在標準定義中，它通常只是一個從動作集合到動作集合的映射)。

交換遺憾衡量的是，對於所有可能的交換函數$$f$$，使用$$f$$修改後的策略的累計回報，與我們實際策略的累計回報之間的差距。

<mark style="color:red;">直觀理解: 交換遺憾是最全面的反思：「無論我用任何規則來系統性地調整我的策略，我能獲得的最大改進是多少？」 它考慮了所有可能的策略調整方式</mark>。

例子 (再次簡化飲料例子):

一個交換函數可能定義為：「如果今天是星期一或星期三，原本喝咖啡就改喝茶；如果今天是星期五，原本喝茶就改成果汁；其他時間保持不變。」 交換遺憾會考慮 所有可能的 這種複雜的交換規則。

