# Wasserstein distance

## ç°¡ä»‹

Wasserstein distanceï¼ˆä¹Ÿç¨±ç‚º Earth Mover's Distance, EMDï¼‰æ˜¯ä¸€ç¨®åœ¨æ©Ÿç‡è«–å’Œæœ€å„ªå‚³è¼¸ç†è«–ä¸­å¸¸ç”¨çš„è·é›¢åº¦é‡ï¼Œç”¨ä¾†è¡¡é‡å…©å€‹æ©Ÿç‡åˆ†ä½ˆä¹‹é–“çš„å·®ç•°ã€‚å®ƒå¾—åæ–¼ã€Œæ¬é‹åœŸæ–¹ã€å•é¡Œï¼ˆEarth Mover's Problemï¼‰ï¼Œ<mark style="color:red;">å…¶æ ¸å¿ƒæ€æƒ³æ˜¯è¨ˆç®—å°‡ä¸€å€‹åˆ†ä½ˆè½‰æ›ç‚ºå¦ä¸€å€‹åˆ†ä½ˆæ‰€éœ€çš„æœ€å°â€œå·¥ä½œé‡â€ï¼Œå³å¦‚ä½•ä»¥æœ€å°çš„æˆæœ¬ï¼ˆå¦‚èƒ½é‡ã€è·é›¢ï¼‰å°‡â€œè³ªé‡â€ï¼ˆæ©Ÿç‡å¯†åº¦ï¼‰å¾ä¸€å€‹åˆ†ä½ˆè½‰ç§»åˆ°å¦ä¸€å€‹åˆ†ä½ˆ</mark>ã€‚

å‡è¨­æœ‰å…©å€‹æ²™å †ï¼ˆåˆ†ä½ˆï¼‰ï¼ŒWasserstein è·é›¢è¡¨ç¤ºå°‡ä¸€å€‹æ²™å †æ¬é‹æˆå¦ä¸€å€‹æ²™å †æ‰€éœ€çš„æœ€å°å·¥ä½œé‡ã€‚æ¬é‹æˆæœ¬ç”±æ²™åœŸç§»å‹•çš„è·é›¢å’Œæ¬é‹é‡æ±ºå®šã€‚å¦‚æœå…©å€‹åˆ†ä½ˆå½¢ç‹€ç›¸ä¼¼ä¸”ä½ç½®æ¥è¿‘ï¼Œè·é›¢è¼ƒå°ï¼›åä¹‹å‰‡è¼ƒå¤§ã€‚

ç›¸è¼ƒæ–¼å…¶ä»–è·é›¢åº¦é‡æ–¹å¼ï¼Œä¾‹å¦‚æ­æ°è·é›¢ï¼ŒWasserstein è·é›¢åœ¨è™•ç†åˆ†ä½ˆä¹‹é–“çš„å·®ç•°æ™‚ï¼Œèƒ½æä¾›æ›´ç´°ç·»çš„åº¦é‡ã€‚å°¤å…¶ç•¶å…©å€‹åˆ†ä½ˆæ²’æœ‰é‡ç–Šæˆ–é‡ç–Šéƒ¨åˆ†å¾ˆå°‘æ™‚(æ”¯æ’é›†ä¸é‡ç–Š)ï¼ŒWasserstein è·é›¢ä»ç„¶èƒ½æä¾›æœ‰æ„ç¾©çš„æ•¸å€¼ï¼Œé€™åœ¨æŸäº›æƒ…æ³ä¸‹éå¸¸é‡è¦ã€‚

## å®šç¾©

asserstein distance å®šç¾©ç‚ºæœ€å„ªå‚³è¼¸å•é¡Œçš„è§£ï¼Œå…¶ç›®æ¨™æ˜¯æ‰¾åˆ°ä¸€ç¨®ã€Œæ¬é‹è¨ˆåŠƒã€ï¼Œä½¿å¾—å°‡ä¸€å€‹åˆ†ä½ˆè®Šæˆå¦ä¸€å€‹åˆ†ä½ˆçš„ç¸½æˆæœ¬æœ€å°åŒ–ã€‚

å°æ–¼å…©å€‹åœ¨ç©ºé–“ ğ‘… ğ‘‘ R d ä¸Šçš„æ©Ÿç‡åˆ†ä½ˆ $$\mu$$ å’Œ $$\nu$$ï¼Œä»¥åŠçµ¦å®šçš„è·é›¢åº¦é‡$$d(x,y)$$ï¼Œp-Wassersteinè·é›¢å®šç¾©ç‚ºï¼š

$$\displaystyle W_p(\mu, \nu)=\left(  \inf_{\gamma \in \prod(\mu, \nu)}  \int_{\mathbb{R}^d \times \mathbb{R}^d} d(x,y)^p d \gamma(x,y)  \right)^{1/p}$$

* $$\prod(\mu, \nu)$$æ˜¯é‚Šéš›åˆ†ä½ˆ$$\mu, \nu$$çš„è¯åˆåˆ†ä½ˆã€‚
* $$d(x,y)$$ç‚ºè·é›¢åº¦é‡å‡½æ•¸ã€‚
* $$p \geq 1$$ç‚ºåƒæ•¸(å¯¦æ•¸)ã€‚

### pythonå¯¦ä½œ

[https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.wasserstein\_distance.html](https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.wasserstein_distance.html)

```python
from scipy.stats import wasserstein_distance

# å®šç¾©å…©å€‹åˆ†ä½ˆ
distribution_1 = [0, 1, 3, 7, 10]
distribution_2 = [1, 2, 4, 6, 9]

# è¨ˆç®— Wasserstein è·é›¢
distance = wasserstein_distance(distribution_1, distribution_2)

print(f"Wasserstein distance: {distance}") 
# è¼¸å‡º Wasserstein distance: 1.0
```

### **ç›´è§€è§£é‡‹**

1. **åˆ†ä½ˆçš„è§£è®€**ï¼šå°‡å…©å€‹æ©Ÿç‡åˆ†ä½ˆè¦–ç‚ºå…©å †åœŸå£¤ï¼Œåˆ†ä½ˆçš„å€¼ä»£è¡¨åœŸå£¤çš„é‡é‡ã€‚
2. **æ¬é‹åœŸå£¤**ï¼šWassersteinè·é›¢é‡åŒ–äº†å°‡ä¸€å †åœŸå£¤ï¼ˆä¾†æºåˆ†ä½ˆï¼‰ã€Œé‡æ–°åˆ†é…ã€æˆå¦ä¸€å †åœŸå£¤ï¼ˆç›®æ¨™åˆ†ä½ˆï¼‰æ‰€éœ€çš„æœ€å°æˆæœ¬ã€‚
3. **æˆæœ¬è¨ˆç®—**ï¼šæ¯å–®ä½é‡é‡çš„æ¬é‹æˆæœ¬ç”±è·é›¢æ±ºå®šå³ $$d(x,y)$$ï¼Œç¸½æˆæœ¬å‰‡æ˜¯æ‰€æœ‰æ¬é‹éç¨‹çš„ç´¯ç©ã€‚

### **ç‰¹æ€§**

1. **ç©©å¥æ€§**ï¼šWassersteinè·é›¢åœ¨æ¯”è¼ƒåˆ†ä½ˆæ™‚å°å°çš„ä½ç§»ç‰¹åˆ¥æ•æ„Ÿï¼Œèƒ½æ•æ‰åˆ†ä½ˆå½¢ç‹€çš„å·®ç•°ã€‚
2. **è€ƒæ…®å¹¾ä½•çµæ§‹**ï¼šä¸åƒ…æ¯”è¼ƒæ©Ÿç‡å€¼ï¼Œé‚„è€ƒæ…®åˆ†ä½ˆæ”¯æ’é›†çš„ç©ºé–“é—œä¿‚ã€‚
3. **é€£çºŒæ€§**ï¼šå³ä½¿åˆ†ä½ˆä¸­æœ‰å°‘é‡çš„å™ªè²ï¼Œè©²è·é›¢ä»å…·æœ‰è‰¯å¥½çš„ç©©å®šæ€§ã€‚
4. **å°ç¨±ä¸”æ»¿è¶³ä¸‰è§’ä¸ç­‰å¼**ï¼šæ˜¯åš´æ ¼çš„åº¦é‡å‡½æ•¸ï¼ˆèˆ‡ KL æ•£åº¦ä¸åŒï¼‰ã€‚
5. <mark style="color:red;">**å¼±æ”¶æ–‚æ•æ„Ÿ**</mark><mark style="color:red;">ï¼šå³ä½¿åˆ†ä½ˆæ”¯æ’é›†ä¸é‡ç–Šï¼Œä¹Ÿèƒ½æä¾›æœ‰æ„ç¾©çš„è·é›¢ï¼ˆå¦‚ç”Ÿæˆå°æŠ—ç¶²è·¯ä¸­çš„ç©©å®šè¨“ç·´ï¼‰</mark>ã€‚

### **èˆ‡å…¶ä»–è·é›¢çš„å°æ¯”**

| åº¦é‡æ–¹æ³•           | å„ªé»               | ç¼ºé»           |
| -------------- | ---------------- | ------------ |
| KL æ•£åº¦          | è¨ˆç®—ç°¡å–®             | ä¸å°ç¨±ï¼›å°ç„¡é‡ç–Šåˆ†ä½ˆå¤±æ•ˆ |
| JS æ•£åº¦          | å°ç¨±               | å°ç„¡é‡ç–Šåˆ†ä½ˆæ¢¯åº¦æ¶ˆå¤±   |
| Wasserstein è·é›¢ | å¹¾ä½•æ•æ„Ÿï¼›æ¢¯åº¦ç©©å®šï¼›åˆ†ä½ˆç„¡éœ€é‡ç–Š | è¨ˆç®—è¤‡é›œåº¦é«˜       |

## ç‰¹ä¾‹ï¼š1-Wassersteinè·é›¢

ç•¶ p=1 æ™‚ï¼Œ1-Wassersteinè·é›¢ï¼ˆåˆç¨± Kantorovich-Rubinstein è·é›¢ï¼‰å…¬å¼ç°¡åŒ–ç‚ºï¼š

$$\displaystyle W_1(\mu, \nu)= \inf_{\gamma \in \prod(\mu, \nu)}  \int_{\mathbb{R}^d \times \mathbb{R}^d} d(x,y) d \gamma(x,y)$$

é€™å€‹ç‰ˆæœ¬çš„è·é›¢è¨ˆç®—æ›´åŠ ç›´è§€ï¼Œå°¤å…¶é©ç”¨æ–¼åˆ†ä½ˆçš„ã€Œè³ªé‡ä¸­å¿ƒã€æœ‰å°å¹…ä½ç§»çš„æƒ…æ³ã€‚

å°å¶å‹å¼ï¼š

$$\displaystyle W_1(\mu, \nu)= \sup_{\|f\|_L \leq 1}  \left| \mathrm{E}_{x \sim \mu} (f(x))  - \mathrm{E}_{y \sim \nu} (f(x))   \right|$$

å…¶ä¸­$$f$$æ˜¯Lipschitz å‡½æ•¸ï¼Œæ»¿è¶³$$|f(x) - f(y)| \leq \| x - y\|$$ã€‚

#### ç¯„ä¾‹

è¨­ P={1,2}, Q={3,4}ï¼Œæ¯å€‹é»çš„è³ªé‡å‡ç‚º 0.5ã€‚ Wasserstein-1 è·é›¢ç‚º:

$$W_1= 0.5 (|1-3| + |2-4|) = 2$$ã€‚

## åƒè€ƒè³‡æ–™

* [https://lilianweng.github.io/posts/2017-08-20-gan/#what-is-wasserstein-distance](https://lilianweng.github.io/posts/2017-08-20-gan/#what-is-wasserstein-distance)
* Ramdas, Garcia, Cuturi â€œOn Wasserstein Two Sample Testing and Related Families of Nonparametric Testsâ€ (2015). [arXiv:1509.02237](https://arxiv.org/abs/1509.02237).
